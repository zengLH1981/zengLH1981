<html>
    <head>

        <title>ChatGPT</title>
        <link rel="icon" type="image/x-icon" href="https://openai.com/favicon.ico">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
            html{

margin: 0;
width: 100%;
height: 100%;
overflow: hidden;
background-color: #333333;
}



:root {
  --body-width: 640px;
}         

@media (max-width: 640px) {
  body {
    --body-width: 100vw;
  }
}

body{

margin: 0;
width: var(--body-width);
height: 100%;
overflow: hidden;
margin: auto;
background-color: #555555;
padding-left: calc(var(--body-width) / 32);
padding-right: calc(var(--body-width) / 32);
padding-top: calc(var(--body-width) / 64);
padding-bottom: calc(var(--body-width) / 64);
}

*{
    box-sizing: border-box;
}



</style>
        <script>
 

function getApiKey()
{
    var k = document.getElementById("apikey").value || window.localStorage.getItem("apikey") || ""
    window.localStorage.setItem("apikey", k);

    return k;
}

$chats = [];
function onChat(){

    if(!getApiKey())
    {
        newChat("API KEY is NULL", "answer");
        return;
    }

    var ask = document.getElementById("ask").value;
    document.getElementById("ask").value = "";

    newChat(ask, "ask");

    $chats.push({"role": "user", "content": ask});
    var body = {
        "model": "gpt-3.5-turbo",
        "messages": $chats,
        "temperature": 0.7
        };


    fetch("https://api.openai.com/v1/chat/completions", {
            "headers": {

                    "Authorization": "Bearer " + getApiKey(),
                    "OpenAI-Organization": "org-MTfXiYjHxPPRBBgOcYaBogP3",
                    "Content-Type": "application/json"

            
            },
            "body": JSON.stringify(body),
            "method": "POST"
            
            }).then(resp=>{
                    resp.json().then(j=>{
                        var answer  = j.choices[0].message.content;
                        newChat(answer, "answer");

                        $chats.push({"role": "assistant", "content":answer});

                       
        });
            });
}

 function newChat(msg, from)
 {
    var d = document.createElement("div");
    d.classList.add("msg");
    d.classList.add(from);
    d.innerText = msg;

    var c = document.getElementById("chats");
    c.appendChild(d);
 

    c.scroll({top:c.clientHeight,left:0,behavior:'smooth' }); 
 }
        </script>

        <style>
            .msg{
                max-width: calc(var(--body-width) * 40 / 64);
                border-radius: calc(var(--body-width) * 5 / 640);
                padding: calc(var(--body-width) / 64);
                margin-bottom: calc(var(--body-width) / 64);
            }
            .ask{
                align-self:flex-start;
                background-color: lightgreen;
                margin-left: calc(var(--body-width) * 5 / 64);
            }
            .ask::before{
                content: '问:';
                white-space: nowrap;
                display: inline-block;
                width: 0; height: 0;
                transform: translateX(calc(var(--body-width) * -5 / 64));
                vertical-align: top;
            }
            .answer{
                align-self:flex-end;
                background-color: lightblue;
                margin-right: calc(var(--body-width) * 5 / 64);
            }
            .answer::before{
                content: ':答';
                white-space: nowrap; 
                width: 0; height: 0;
                transform: translateX(calc(var(--body-width) * 25 / 640)); 
                float: right;
            }


            #chats{
                width: translateX(calc(var(--body-width) * 580 / 640)); 
                flex-grow: 1; border: solid 1px black; overflow-y: scroll; display: flex; 
                flex-direction: column; 
                padding: translateX(calc(var(--body-width) / 64)); 
                background-color: white; margin: 0;
            }

            #formdiv{
                display: flex; width: calc(var(--body-width) * 60/ 64);height: calc(var(--body-width) * 10 / 64);
            }
            #formdiv img{
                width:  calc(var(--body-width) * 10 / 64);
                height:  calc(var(--body-width) * 10 / 64);
            }
            #apikey{
                width:calc(var(--body-width) * 60/ 64); height: calc(var(--body-width) * 3/ 64);
            }
 
        </style>
    </head>
    <body style="display: flex;flex-direction: column;">

        <div id="chats"  >

        </div>

        
        <br />
        <div id="formdiv">
            <textarea id="ask" style="width: 80%;height: 100%;" placeholder="输入要问的事情"></textarea>
            <button style="width: 20%;height: 100%; background-color: transparent; border: 0;" onclick="javascript:onChat()"><img src="https://openai.com/favicon.ico"/></button>
        </div>
        <br />
        <input id="apikey"   value="" placeholder="API-KEY"/> 
    </body>
</html>